<template>
  <div class="img-upload-body">
    <div class="crissy-card">
      <div class="card-img">
        <img class="card-display-img" :src="imgUrl">
        <div class="upload-box">
          <input class="upload" type="file" name="Files" accept="image/*" @change="getFile" />
          <div class="upload-bg">
            <img src="@/assets/img/photos_object.png" alt="">
          </div>
        </div>
      </div>
      <div class="card-info">
        <span class="card-author">
          <img :src="userInfo.userAvatar">
        </span>
        <span class="card-title" v-if="!isWrite">
          {{ imgTitle }}
          <span @click="ifWrite()" class="card-title-svg" title="点击编辑标题">
            <svg t="1684161065904" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
              p-id="3490" width="17" height="17">
              <path
                d="M770.089796 909.061224H194.35102c-43.885714 0-79.412245-35.526531-79.412244-79.412244V253.910204c0-43.885714 35.526531-79.412245 79.412244-79.412245h387.134694c10.971429 0 19.853061 8.881633 19.853062 19.853061 0 10.971429-8.881633 19.853061-19.853062 19.853062H194.35102c-21.942857 0-39.706122 17.763265-39.706122 39.706122v575.738776c0 21.942857 17.763265 39.706122 39.706122 39.706122h575.738776c21.942857 0 39.706122-17.763265 39.706122-39.706122V442.514286c0-10.971429 8.881633-19.853061 19.853062-19.853062 10.971429 0 19.853061 8.881633 19.853061 19.853062v387.134694c0 43.885714-35.526531 79.412245-79.412245 79.412244z"
                fill="#7BD4EF" p-id="3491"></path>
              <path
                d="M887.640816 136.359184c-27.167347-27.167347-70.008163-28.212245-95.608163-3.134694L532.897959 392.359184l-1.567347 1.567347-0.522449 0.522449-0.522449 0.522449c-14.628571 15.15102-26.644898 32.391837-35.52653 51.722449L464.979592 509.910204c-6.269388 13.583673-3.134694 29.257143 7.836735 40.75102 7.314286 7.314286 16.195918 10.971429 25.6 10.971429 5.22449 0 9.926531-1.044898 14.628571-3.134694l63.216326-29.779592c19.330612-8.881633 36.571429-20.897959 51.722449-35.52653l0.522449-0.522449 0.522449-0.522449 1.567347-1.567347 259.134694-259.134694c26.644898-25.6 25.077551-68.440816-2.089796-95.085714z m-326.530612 355.787755l-54.857143 25.6 25.6-54.857143c4.179592-9.404082 9.404082-17.763265 15.67347-25.6l39.706122 39.706122c-8.359184 5.746939-17.240816 10.971429-26.122449 15.151021z"
                fill="#16C4AF" p-id="3492"></path>
            </svg>
          </span>
        </span>
        <span class="card-title" v-if="isWrite">
          <input class="card-title-input" type="text" maxlength="7" v-model="imgTitle" @blur="ifWrite()">
        </span>
        <span class="card-describe">
          {{ userInfo.loginName }} | {{ imgDate }}
        </span>
        <span @click="getDate()" title="点击自动更新日期" class="info-svg">
          <svg t="1684135123563" class="icon" viewBox="0 0 1070 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
            p-id="3722" width="20" height="20">
            <path
              d="M534.91112 1024h-18.199616c-145.596924-4.549904-282.09404-65.973606-379.916973-170.621395-93.273029-97.822933-141.04702-227.495193-136.497116-359.442406C11.672175 211.842159 259.641936-8.828178 553.110735 0.271629 700.982611 4.821533 835.204775 66.245235 933.027708 170.893024c93.273029 97.822933 141.04702 227.495193 136.497117 359.442406l-45.499039-2.274952c4.549904-120.572453-38.674183-236.595001-122.847405-325.318127-90.998077-97.822933-213.845482-152.42178-350.342598-156.971683-268.444328-9.099808-493.66457 193.370914-502.764377 450.440483-4.549904 120.572453 38.674183 236.595001 122.847404 325.318127 88.723125 95.547981 213.845482 152.42178 348.067646 156.971683 106.922741 2.274952 211.57053-25.024471 298.018704-84.173221 45.499039-31.849327 86.448174-68.248558 118.2975-111.472645l36.399231 27.299423c-36.399231 47.773991-79.623318 88.723125-129.67226 122.847405-90.998077 59.14875-195.645866 90.998077-307.118511 90.998077z"
              fill="#46AAFF" p-id="3723"></path>
            <path
              d="M569.740634 888.845106c-43.155838-0.432241-88.404632-8.781314-131.423973-23.614002l7.416343-21.498295c179.948698 64.38114 375.025826-20.042327 434.94806-187.092047 31.781079-85.310698 23.363756-179.607455-22.590272-262.802448l20.247072-9.873291c49.502954 86.812166 57.101294 190.481726 23.841496 280.092082-50.276438 139.067812-185.658827 224.788001-332.438726 224.765251z"
              fill="#46AAFF" p-id="3724"></path>
            <path d="M525.083327 296.083629l22.74952-0.113747 1.455969 268.444328-22.749519 0.113748z" fill="#4CADFF"
              p-id="3725"></path>
            <path d="M528.382008 566.32517l13.649711-18.176866 165.457255 124.439871-13.695211 18.199615z" fill="#4CADFF"
              p-id="3726"></path>
          </svg>
        </span>
      </div>
    </div>
    <div class="crissy-card-info">
      <ul>
        <li>作品名：<input type="text" v-model="imgName"></li>
        <li>原创作者：<input type="text"></li>
        <li>关键词：<input type="text" v-model="imgKeyword"></li>
        <li>作品完成时间(照片内置时间)：<input type="text" v-model="lastModifiedDate"></li>
        <li>
          <svg @click="toSubmit()" t="1684160711680" class="icon" viewBox="0 0 1026 1024" version="1.1"
            xmlns="http://www.w3.org/2000/svg" p-id="2483" width="60" height="100">
            <path
              d="M963.087 212.044H62.417C27.946 212.044 0 239.99 0 274.462v436.632c0 34.475 27.945 62.418 62.418 62.418h900.669c34.473 0 62.415-27.944 62.415-62.418V274.462c0-34.472-27.944-62.418-62.415-62.418zM182.416 432.02h-17.589c-5.756 0-10.233-1.703-13.43-5.116-3.414-3.623-5.117-8.1-5.117-13.431 0-5.326 1.703-9.699 5.116-13.112 3.198-3.407 7.675-5.116 13.431-5.116h17.589V355.91c0-6.18 1.703-11.193 5.116-15.03 3.408-3.408 7.78-5.222 13.112-5.437 5.326 0.215 9.699 1.919 13.111 5.116 3.623 3.838 5.437 8.954 5.437 15.35v39.334h18.548c5.54 0 9.913 1.6 13.111 4.797 3.408 3.628 5.117 8.105 5.117 13.431 0 5.331-1.71 9.703-5.117 13.112-3.413 3.627-7.784 5.436-13.111 5.436h-18.548v48.928c4.477-4.262 10.018-5.647 16.629-4.158 4.477 1.07 8.1 3.837 10.873 8.314 2.768 4.907 3.837 9.703 3.197 14.391-0.215 4.267-3.307 8.105-9.274 11.512-5.756 3.413-12.9 7.036-21.426 10.873v83.783c0 16.415-6.396 28.78-19.187 37.095-7.25 4.263-16.31 5.966-27.182 5.117-14.285-0.214-23.664-3.519-28.14-9.914-2.35-4.267-3.093-8.954-2.24-14.07 2.768-11.727 10.554-16.31 23.345-13.752 2.983 0.21 4.901 0.21 5.756 0 2.768 0.64 5.116 0 7.035-1.919 2.768-2.772 4.047-6.825 3.838-12.151v-59.48a1568.64 1568.64 0 0 1-15.99 5.437c-5.546 1.709-10.342 1.495-14.39-0.64-4.268-2.128-7.145-5.86-8.635-11.193-1.494-4.901-1.28-9.593 0.64-14.07 2.128-4.477 5.861-7.46 11.192-8.954 7.885-2.768 16.95-6.076 27.183-9.914V432.02z m102.33 177.8c-10.448 23.874-20.147 36.562-29.1 38.055-4.268 0.21-8.745-1.07-13.431-3.838-4.907-3.412-7.785-7.465-8.635-12.152-0.855-4.906 0.32-9.703 3.518-14.39 14.07-20.466 23.024-42.212 26.862-65.236 1.064-15.56 3.518-24.943 7.355-28.141 3.838-2.768 8.42-4.047 13.751-3.837 4.902 0.64 9.06 2.667 12.473 6.076 4.262 4.692 4.686 16.948 1.279 36.775 0.64 0.215 1.064 0.749 1.279 1.599 0.21 1.07 0.64 2.028 1.279 2.879 7.885 16.628 18.972 28.46 33.257 35.496v-89.859h-63.638c-5.546 0-9.914-1.599-13.112-4.797-3.197-3.407-4.797-7.78-4.797-13.111 0-4.902 1.6-9.06 4.797-12.473 3.408-3.407 7.78-5.116 13.112-5.116h161.17c5.327 0.215 9.594 1.709 12.792 4.477 3.198 3.413 4.796 7.784 4.796 13.112 0 4.906-1.6 9.063-4.796 12.472-3.198 3.627-7.465 5.436-12.791 5.436h-60.76v28.46h49.248c5.326 0.216 9.593 1.71 12.79 4.478 3.199 3.413 4.798 7.784 4.798 13.111 0 4.907-1.6 9.064-4.797 12.472-3.198 3.628-7.465 5.437-12.791 5.437h-49.247v31.02H433.444c6.182 0.21 11.194 2.025 15.03 5.436 3.624 3.198 5.542 7.675 5.756 13.431-0.214 5.542-1.918 10.02-5.116 13.431-4.052 3.838-9.273 5.756-15.67 5.756h-44.13c-16.203-0.214-31.447-1.388-45.729-3.518-23.023-3.202-42.64-14.184-58.839-32.941z m10.873-142.623c-7.25-0.21-12.901-2.879-16.95-7.996-5.116-6.605-7.569-13.536-7.355-20.786V371.58c0-6.606 2.344-12.257 7.035-16.95 4.902-5.116 10.658-7.564 17.269-7.355H408.82c8.314-0.21 15.35 2.24 21.106 7.356 4.686 4.267 7.14 9.914 7.355 16.949v66.835c0 7.465-2.988 14.18-8.954 20.147-5.756 5.546-12.26 8.424-19.507 8.635H295.619z m106.168-73.87v-3.837c0-1.704-0.64-3.198-1.919-4.477-1.709-1.49-3.307-2.24-4.797-2.24h-81.545c-1.92-0.209-3.518 0.43-4.798 1.92-1.279 1.708-1.918 3.307-1.918 4.797v3.837h94.977z m-94.976 27.82v3.838c0 1.71 0.64 3.308 1.918 4.797 1.28 1.28 2.879 1.92 4.798 1.92h81.545c1.919 0 3.518-0.746 4.797-2.24 1.064-1.489 1.704-2.983 1.919-4.477v-3.837H306.81z m292.921 107.768c-4.907-1.279-8.744-4.157-11.512-8.634-2.772-5.117-3.518-9.914-2.24-14.391 1.28-5.117 4.584-9.379 9.915-12.792 32.618-21.53 57.56-47.967 74.829-79.306 1.065-1.918 2.344-3.518 3.837-4.797H604.85c-5.756 0-10.233-1.704-13.431-5.117-3.412-3.622-5.117-8.099-5.117-13.43 0-5.327 1.705-9.7 5.117-13.112 3.198-3.408 7.675-5.117 13.43-5.117H722.21c-2.988-13.855-3.519-23.024-1.6-27.5 2.558-4.263 6.502-7.142 11.833-8.636 5.326-1.703 10.233-1.279 14.71 1.28 7.035 4.052 11.618 15.67 13.75 34.856h111.285c5.543 0 9.914 1.6 13.112 4.798 3.408 3.627 5.117 8.104 5.117 13.43 0 5.332-1.71 9.704-5.117 13.112-3.412 3.628-7.784 5.437-13.112 5.437h-72.27c1.918 1.07 3.837 2.349 5.756 3.837 24.513 21.536 50.311 50.846 77.387 87.941 3.624 5.117 5.117 10.024 4.477 14.71-0.64 5.117-3.198 9.384-7.675 12.792-4.477 2.987-9.063 4.052-13.751 3.197-4.907-0.849-9.274-3.941-13.112-9.273-10.023-13.43-19.507-25.367-28.46-35.815-14.501 34.111-33.579 62.357-57.243 84.742 27.502 17.484 62.038 30.699 103.61 39.653 6.606 1.705 11.299 4.583 14.07 8.634 2.559 4.263 3.408 9.06 2.559 14.391-1.709 5.756-4.587 9.7-8.635 11.833-4.69 2.984-10.023 3.837-15.989 2.558-48.397-10.447-90.179-28.461-125.355-54.044-33.471 22.595-74.51 40.079-123.117 52.444-6.186 1.705-11.512 1.17-15.99-1.599-4.476-2.348-7.464-6.186-8.953-11.512-1.07-5.546-0.533-10.343 1.6-14.39 2.767-4.692 12.151-9.064 28.14-13.113 37.095-10.446 67.155-22.489 90.18-36.136-10.873-11.296-20.897-24.727-30.06-40.292-8.315-13.216-15.35-26.327-21.106-39.333-28.14 27.716-47.646 40.612-58.519 38.694z m111.604-12.791c8.524 12.367 17.375 23.024 26.542 31.978 27.502-24.728 47.328-55.427 59.48-92.097-5.546-5.756-10.873-10.873-15.989-15.35-4.69-4.047-7.356-8.635-7.995-13.751 0-4.902 1.705-9.379 5.116-13.431 1.49-2.128 3.198-3.623 5.117-4.477h-83.144c2.559 2.134 4.263 4.907 5.117 8.314 1.065 5.332 0 10.663-3.198 15.99-5.97 8.953-11.832 17.377-17.589 25.263 8.526 24.733 17.375 43.92 26.543 57.56z"
              fill="#FF962F" p-id="2484"></path>
          </svg>
        </li>
      </ul>
    </div>
  </div>
</template>

<script setup>
import { onMounted, ref } from "vue";
import Store from "@/store";
import { storeToRefs } from "pinia";
import { addCardAPI } from "@/http/api/card";

const { userStore } = Store();

const { userInfo } = storeToRefs(userStore);

let isWrite = ref(false);
let imgTitle = ref("宝藏作品");
let imgDate = ref("");
let imgName = ref("");
let imgUrl = ref("");
let imgKeyword = ref("");
let lastModifiedDate = ref("")

const ifWrite = function () {
  isWrite.value = !isWrite.value;
}

const getFile = (file) => {
  if (file.target.files.length === 0) return;
  let reader = new FileReader();
  //文件读取成功时触发
  reader.onload = () => {
    imgName.value = file.target.files[0].name;
    lastModifiedDate.value = file.target.files[0].lastModifiedDate;

    imgUrl.value = reader.result
  }
  //将读取到的文件编码成DataUrl
  reader.readAsDataURL(file.target.files[0])
}

const getDate = function () {
  let time = new Date();
  let year, month, day;
  year = time.getFullYear();
  month = time.getMonth() + 1;
  day = time.getDate();
  let date = year + "-" + month + "-" + day;
  imgDate.value = date;
}

const toSubmit = function () {
  let data = {
    cardImg: imgUrl.value,
    cardTitle: imgTitle.value,
    cardKeyword: imgKeyword.value,
  }
  console.log(data)
  addCardAPI(data).then(res => {
    console.log(res)
  })
}

onMounted(() => {
  getDate();
})
</script>
  
<style scoped>
* {
  font-family: "Courier New", Courier, monospace, Helvetica, sans-serif;
  font-weight: 500;
}

.img-upload-body {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  position: relative;
}

.crissy-card {
  margin-top: 3rem;
  display: inline-block;
  width: 240px;
  height: 185px;
  padding: 10px 10px;
  box-shadow: 0px 3px 3px rgba(0, 0, 0, 0.3);
}

.card-img {
  width: 100%;
  height: 135px;
  overflow: hidden;
  position: relative;
  box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.2);
}

.card-img .card-display-img {
  width: 100%;
  height: 100%;
}

.upload-box {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
}

.upload {
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}

.upload-bg {
  position: absolute;
  top: 0;
  left: 0;

  width: 100%;
  height: 100%;
  z-index: -1;

  display: flex;
  justify-content: center;
}

.upload-bg img {
  position: absolute;
  top: 2rem;
  width: 80px;
}

.card-info {
  width: 100%;
  height: 30px;
  margin-top: 10px;
  position: relative;
}

.card-author {
  position: absolute;
  width: 40px;
  height: 40px;
  overflow: hidden;
  border-radius: 50%;
  cursor: pointer;
  transition: .6s;
}

.card-author:hover {
  width: 50px;
  height: 50px;
}

.card-author img {
  width: 100%;
  height: 100%;
}


.card-title {
  position: absolute;
  top: 5px;
  left: 50px;
  width: 130px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-size: 14px;
}

.card-title-input {
  outline: none;
  border: none;
  background: rgba(0, 0, 0, 0.2);
}


.card-title-svg {
  cursor: pointer;
}

.card-describe {
  position: absolute;
  width: 170px;
  left: 40px;
  top: 28px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-size: 12px;
  color: #767688;
  transform: scale(.9);
}

.info-svg {
  position: absolute;
  cursor: pointer;
  right: 0;
}

.card-img img[src=""],
.card-img img:not([src]) {
  width: 100%;
  height: 100%;

  opacity: 0;
}

.crissy-card-info {
  position: absolute;
  top: 280px;
  width: 100%;
  height: 200px;
}

.crissy-card-info ul {
  width: 100%;
  height: 100%;
}

.crissy-card-info ul li {
  list-style: none;
  height: 25%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.crissy-card-info ul li input {
  font-size: inherit;
  width: 60%;
  color: #ac36c4;
  outline: none;
  display: block;
  font-weight: 400;
  line-height: 1.6;
  padding: 3px 3px 3px 10px;
  border-radius: 20px;
  border: 1px solid #8c8c8c;
  background-color: transparent;
  transition: border-color 0.2s ease-in-out;
  background-repeat: no-repeat;
  background-position: right 2% center;
  background-size: 2rem 2rem;
}

li svg {
  cursor: pointer;
}

li svg:active {
  width: 50px;
  height: 90px;
}
</style>